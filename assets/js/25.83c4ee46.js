(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{576:function(a,t,e){a.exports=e.p+"assets/img/sql-database-deployment-options.508ea38a.png"},577:function(a,t){a.exports="data:image/png;base64,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"},578:function(a,t,e){a.exports=e.p+"assets/img/sqlunmasked.e7150a6c.png"},579:function(a,t,e){a.exports=e.p+"assets/img/sqlmasked.84c480df.png"},580:function(a,t,e){a.exports=e.p+"assets/img/sqlfailovergroup.1a672e8b.png"},581:function(a,t,e){a.exports=e.p+"assets/img/azure-data-studio-connect.b41dff71.png"},582:function(a,t,e){a.exports=e.p+"assets/img/azure-data-studio-new-query.1eba088b.png"},583:function(a,t,e){a.exports=e.p+"assets/img/permissions-of-database-roles.163bc268.png"},865:function(a,t,e){"use strict";e.r(t);var s=e(28),r=Object(s.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"challenge-2-azure-sql-db-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#challenge-2-azure-sql-db-optional"}},[a._v("#")]),a._v(" Challenge 2: Azure SQL DB (optional)")]),a._v(" "),s("h2",{attrs:{id:"here-is-what-you-will-learn-üéØ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn-üéØ"}},[a._v("#")]),a._v(" Here is what you will learn üéØ")]),a._v(" "),s("p",[a._v("In this challenge you will learn how to:")]),a._v(" "),s("ul",[s("li",[a._v("create an Azure SQL DB (Single Database)")]),a._v(" "),s("li",[a._v("add Data to the Azure SQL DB")]),a._v(" "),s("li",[a._v("setup Dynamic Data Masking")])]),a._v(" "),s("h2",{attrs:{id:"table-of-contents"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#table-of-contents"}},[a._v("#")]),a._v(" Table Of Contents")]),a._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"#basics"}},[a._v("Basics")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#deployment-models"}},[a._v("Deployment models")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#purchasing-models"}},[a._v("Purchasing models")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#create-a-single-sql-database"}},[a._v("Create a single SQL Database")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#add-data-to-sql-db"}},[a._v("Add Data to SQL DB")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#add-data-to-sql-db-using-the-azure-data-studio"}},[a._v("Add Data to SQL DB using the Azure Data Studio")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#setup-dynamic-data-masking"}},[a._v("Setup Dynamic Data Masking")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#access-management-for-azure-sql-db"}},[a._v("Access Management for Azure SQL DB")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#sql-database-backup-and-retention-policies-optional"}},[a._v("SQL Database backup and retention policies (optional)")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#connect-the-azure-sql-db-to-a-web-application-optional"}},[a._v("Connect the Azure SQL DB to a Web Application (optional)")])]),a._v(" "),s("li",[s("a",{attrs:{href:"#cleanup"}},[a._v("Cleanup")])])]),a._v(" "),s("h2",{attrs:{id:"basics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#basics"}},[a._v("#")]),a._v(" Basics")]),a._v(" "),s("p",[a._v("Azure SQL Database is a general-purpose relational database, provided as a managed service. It's based on the latest stable version of "),s("a",{attrs:{href:"https://docs.microsoft.com/sql/sql-server/sql-server-technical-documentation?toc=/azure/sql-database/toc.json",target:"_blank",rel:"noopener noreferrer"}},[a._v("Microsoft SQL Server database engine"),s("OutboundLink")],1),a._v(". In fact, the newest capabilities of SQL Server are released first to SQL Database, and then to SQL Server itself. You get the newest SQL Server capabilities with no overhead for patching or upgrading, tested across millions of databases.")]),a._v(" "),s("p",[a._v("To get started with SQL Database consult the documentation "),s("a",{attrs:{href:"https://docs.microsoft.com/azure/sql-database/sql-database-technical-overview",target:"_blank",rel:"noopener noreferrer"}},[a._v("here"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("h2",{attrs:{id:"deployment-models"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment-models"}},[a._v("#")]),a._v(" Deployment models")]),a._v(" "),s("p",[a._v("Let us have a look at the different deployment models of SQL Database first:")]),a._v(" "),s("p",[s("img",{attrs:{src:e(576),alt:"SQL database Deployment options"}})]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-sql/database/single-database-overview",target:"_blank",rel:"noopener noreferrer"}},[a._v("Single database"),s("OutboundLink")],1),a._v(" represents a fully managed, isolated database. You might use this option if you have modern cloud applications and microservices that need a single reliable data source. A single database is similar to a contained database in Microsoft SQL Server Database Engine.")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-sql/managed-instance/sql-managed-instance-paas-overview",target:"_blank",rel:"noopener noreferrer"}},[a._v("Managed instance"),s("OutboundLink")],1),a._v(" is a fully managed instance of the Microsoft SQL Server Database Engine. It contains a set of databases that can be used together. Use this option for easy migration of on-premises SQL Server databases to the Azure cloud, and for applications that need to use the database features that SQL Server Database Engine provides.")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-sql/database/elastic-pool-overview",target:"_blank",rel:"noopener noreferrer"}},[a._v("Elastic pool"),s("OutboundLink")],1),a._v(" is a collection of single databases with a shared set of resources, such as CPU or memory. Single databases can be moved into and out of an elastic pool.")])]),a._v(" "),s("h2",{attrs:{id:"purchasing-models"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#purchasing-models"}},[a._v("#")]),a._v(" Purchasing models")]),a._v(" "),s("p",[a._v("SQL Database offers the following purchasing models:")]),a._v(" "),s("ul",[s("li",[a._v("The vCore-based purchasing model lets you choose the number of vCores, the amount of memory, and the amount and speed of storage.")]),a._v(" "),s("li",[a._v("The DTU-based purchasing model offers a blend of compute, memory, and I/O resources in three service tiers, to support light to heavy database workloads. Compute sizes within each tier provide a different mix of these resources, to which you can add additional storage resources")]),a._v(" "),s("li",[a._v("The serverless model automatically scales compute based on workload demand, and bills for the amount of compute used per second. The serverless compute tier also automatically pauses databases during inactive periods when only storage is billed, and automatically resumes databases when activity returns.")])]),a._v(" "),s("p",[a._v("You see that each purchasing model refers to compute, memory and I/O resources, because these are the most important and crtical resources a databse uses.")]),a._v(" "),s("h2",{attrs:{id:"create-a-single-sql-database"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-a-single-sql-database"}},[a._v("#")]),a._v(" Create a single SQL Database")]),a._v(" "),s("p",[a._v("The single database deployment option creates a database in Azure SQL Database with its own set of resources and is managed via a SQL Database server. With a single database, each database is isolated from each other and portbale, each with its own service tier within the DTU-based purchasing model or vCore-based purchasing model and a guaranteed compute size.")]),a._v(" "),s("p",[a._v("Navigate to the azure portal and open the cloud shell. We use the Azure CLI to create the needed Azure resources:")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("Create a resource group:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az group create --name adc-sql-db-rg --location westeurope\n")])])])]),a._v(" "),s("li",[s("p",[a._v("Create the server instance and note down the "),s("strong",[a._v("fullyQualifiedDomainName")]),a._v(" of your server from the output")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("üìù The Azure SQL Server name has to be unique.\nThe password should be at least 8 letters, must contain capital letters and numbers, refrain from using $.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql server create --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of the server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --location westeurope --admin-user "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --admin-password "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[a._v("Per default the access is not permitted via the Azure SQL Server. Configure the server's firewall to allow your IPv4")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql server firewall-rule create --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --name AllowYourIp --start-ip-address "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("your public ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --end-ip-address "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("your public Ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[a._v("Create the SQL Database with vCore-based purchasing Gen5, 1 vCore and max 32GB in size. "),s("a",{attrs:{href:"https://docs.microsoft.com/azure/sql-database/sql-database-service-tiers-vcore",target:"_blank",rel:"noopener noreferrer"}},[a._v("Here"),s("OutboundLink")],1),a._v(" you will find a good overview of the vCore model.")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql db create --name MSFTEmployees --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --edition GeneralPurpose --family Gen5 --capacity "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" --max-size 32GB --zone-redundant "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n")])])])])]),a._v(" "),s("h2",{attrs:{id:"add-data-to-sql-db"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#add-data-to-sql-db"}},[a._v("#")]),a._v(" Add Data to SQL DB")]),a._v(" "),s("p",[a._v("Now that your SQL Database is up and running it's time to add some data. First we will use the Azure CLI to do so:")]),a._v(" "),s("ol",[s("li",[a._v("Get to know your environment")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql server list --resource-group adc-sql-db-rg\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql db list --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("If you run the command like this you are getting a lot of information to make sense of. You can restrict this by using a query:")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql db list --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --query "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'[].{Name: name}'")]),a._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql db show --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --name MSFTEmployees --query "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{Name: name, maxSizeBytes: maxSizeBytes, status: status}'")]),a._v("\n")])])]),s("h3",{attrs:{id:"connect-to-your-sql-db"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#connect-to-your-sql-db"}},[a._v("#")]),a._v(" Connect to your SQL DB")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql db show-connection-string --name MSFTEmployees --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --client sqlcmd\n")])])]),s("p",[a._v("For the next part to work you either have the "),s("code",[a._v("sqlcmd")]),a._v(" extension or go on using the Azure Cloud Shell (PowerShell). Copy the "),s("code",[a._v("sqlcmd")]),a._v(" command and enter your admin name and password. The command should look something like this:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("sqlcmd -S tcp:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Name of your Server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(".database.windows.net,1433 -d MSFTEmployees -U "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" -P "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" -N -l "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("üìù You might need to renew the firewall-rule at this point. The error output includes the needed IP address.")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql server firewall-rule create --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --name AllowYourIp --start-ip-address "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("your public ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --end-ip-address "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("your public Ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])])]),a._v(" "),s("p",[a._v("After running this you should see a "),s("code",[a._v("1>")]),a._v(". Now you can run SQL Queries. If you are unfamiliar with their Syntax feel free to take some time getting used to it:")]),a._v(" "),s("ol",[s("li",[a._v("Add a table.")])]),a._v(" "),s("div",{staticClass:"language-Sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" CEOs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("EmployerID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" LastName "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" FirstName "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Age "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" StartYear "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nGO\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("Add Data to your table")])]),a._v(" "),s("div",{staticClass:"language-Sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INSERT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INTO")]),a._v(" CEOs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("EmployerID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" LastName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" FirstName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" StartYear"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("VALUES")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Nadella'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Satya'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("51")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2014")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nGO\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("Update the Age of Satya Nadella in the Table")])]),a._v(" "),s("div",{staticClass:"language-Sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("UPDATE")]),a._v(" CEOs "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" Age"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("53")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WHERE")]),a._v(" EmployerID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nGO\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("Query the data")])]),a._v(" "),s("div",{staticClass:"language-Sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" CEOs\nGO\n")])])]),s("h2",{attrs:{id:"setup-dynamic-data-masking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setup-dynamic-data-masking"}},[a._v("#")]),a._v(" Setup Dynamic Data Masking")]),a._v(" "),s("p",[a._v("Dynamic data masking (DDM) limits sensitive data exposure by masking it to non-privileged users. It can be used to greatly simplify the design and coding of security in your application. Take a look at the documentation "),s("a",{attrs:{href:"https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking?view=sql-server-ver15",target:"_blank",rel:"noopener noreferrer"}},[a._v("here"),s("OutboundLink")],1),a._v(" to get more information about Dynamic Data Masking.")]),a._v(" "),s("p",[s("img",{attrs:{src:e(577),alt:"Dynamic Data Masking"}})]),a._v(" "),s("p",[a._v("To see Dynamic Data Masking in action we first add a column to the CEOs table with a Data Masking Rule.")]),a._v(" "),s("p",[a._v("If you have exited the sqlcmd utility program, reconnect as follows:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("sqlcmd -S tcp:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Name of your Server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(".database.windows.net,1433 -d MSFTEmployees -U "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" -P "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" -N -l "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v("\n")])])]),s("p",[a._v("Run the following after "),s("code",[a._v("1>")]),a._v(":")]),a._v(" "),s("ol",[s("li",[a._v("Add the column email and mask it.")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ALTER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("dbo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("CEOs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ADD")]),a._v(" Email "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" MASKED "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WITH")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FUNCTION")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'EMAIL()'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nGO\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("Run another query to add more information to the table:")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INSERT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INTO")]),a._v(" CEOs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("EmployerID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" LastName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" FirstName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" StartYear"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("VALUES")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Gates'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Bill'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("65")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1975")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'bgates@microsoft.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("UPDATE")]),a._v(" CEOs "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" Email"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'snadella@microsoft.com'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WHERE")]),a._v(" EmployerID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nGO\n")])])]),s("p",[a._v("When we select the top 1000 rows of the Contacts table we still see the email's actual value.")]),a._v(" "),s("p",[s("img",{attrs:{src:e(578),alt:"Not Masked"}})]),a._v(" "),s("p",[a._v("The reason behind this is that the account we have used has elevated privileges. To show you how Dynamic Data Masking works we create a user and grant select on CEOs.")]),a._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[a._v("Run the following:")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("USER")]),a._v(" TestUser WITHOUT LOGIN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("GRANT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ON")]),a._v(" CEOs "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TO")]),a._v(" TestUser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nGO\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("EXECUTE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("AS")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("USER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'TestUser'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" CEOs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nGO\n")])])]),s("p",[s("img",{attrs:{src:e(579),alt:"Masked"}})]),a._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[a._v("To exit the sqlcmd utility program enter "),s("code",[a._v("exit")]),a._v(".")])]),a._v(" "),s("h2",{attrs:{id:"sql-database-backup-and-retention-policies"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sql-database-backup-and-retention-policies"}},[a._v("#")]),a._v(" SQL Database backup and retention policies")]),a._v(" "),s("p",[a._v("You make the choice between configuring your server for either locally redundant backups or geographically redundant backups at server creation.\nAfter a server is created, the kind of redundancy it has, geographically redundant vs locally redundant, can't be switched.\nWhile creating a server via the "),s("code",[a._v("az sql server create")]),a._v(" command, the "),s("code",[a._v("--geo-redundant-backup")]),a._v(" parameter decides your Backup Redundancy Option. If "),s("code",[a._v("Enabled")]),a._v(", geo redundant backups are taken. Or if "),s("code",[a._v("Disabled")]),a._v(" locally redundant backups are taken.\nIn our current database geo redundant backups therefore are not possible.")]),a._v(" "),s("ul",[s("li",[a._v("Go to the Azure portal and navigate to your SQL server")]),a._v(" "),s("li",[a._v("Under Manage Backups you will find the retention policies")]),a._v(" "),s("li",[a._v("Change the retention policy for MicrosoftEmployees to Monthly Backups that should be kept for 8 weeks.")]),a._v(" "),s("li",[a._v("On the Available backups tab, you will find backups from which you can restore a specific database.")])]),a._v(" "),s("p",[a._v("As a declarative abstraction on top of the existing active geo-replication feature, Auto-failover groups are a SQL Database feature that allows you to manage replication and failover of a group of databases on a SQL Database server or all databases in a managed instance to another region.\nThey are designed to simplify deployment and management of geo-replicated databases at scale.")]),a._v(" "),s("p",[a._v("When you are using auto-failover groups with automatic failover policy, any outage that impacts one or several of the databases in the group results in automatic failover. Typically these are incidents that cannot be self-mitigated by the built-in automatic high availability operations. The examples of failover triggers include an incident caused by a SQL tenant ring or control ring being down due to an OS kernel memory leak on several compute nodes, or an incident caused by one or more tenant rings being down because a wrong network cable was cut during routine hardware decommissioning. For more information, see SQL Database High Availability.")]),a._v(" "),s("ol",[s("li",[a._v("Create another Azure SQL Server in another azure region")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql server create --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your second server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --location northeurope --admin-user "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --admin-password "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("Create a failover group between the servers and add the database")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql failover-group create --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your fg"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --partner-server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your second server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --add-db MSFTEmployees --failover-policy Automatic\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("Verify which server is secondary")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql failover-group list --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("Failover to the secondary server")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql failover-group set-primary --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your fg"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your second server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[a._v("Revert failover group back to the primary server")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql failover-group set-primary --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your fg"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("Take a look at the failover group in the Azure portal. Find your SQL server. Under Data management select Failover groups. Select your failover group. You will see something like this:")]),a._v(" "),s("p",[s("img",{attrs:{src:e(580),alt:"Failover Group in the Azure portal"}})]),a._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[a._v("Delete the resources you created in this challenge if you do not want to go through the optional content")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az group delete --resource-group adc-sql-db-rg\n")])])]),s("h2",{attrs:{id:"add-data-to-sql-db-using-the-azure-data-studio-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#add-data-to-sql-db-using-the-azure-data-studio-optional"}},[a._v("#")]),a._v(" Add Data to SQL DB using the Azure Data Studio (optional)")]),a._v(" "),s("p",[a._v("Another, more simple approach to add data to your Azure SQL database is using the Azure Data Studio. Azure Data Studio is a cross-platform database tool for data professionals using the Microsoft family of on-premises and cloud data platforms on Windows, MacOS, and Linux.")]),a._v(" "),s("p",[a._v("Azure Data Studio offers a modern editor experience with IntelliSense, code snippets, source control integration, and an integrated terminal. It's engineered with the data platform user in mind, with built-in charting of query result sets and customizable dashboards.")]),a._v(" "),s("ol",[s("li",[a._v("Open the "),s("code",[a._v("Azure Data Studio")]),a._v(" and connect to your server:")])]),a._v(" "),s("p",[s("img",{attrs:{src:e(581),alt:"Azure Data Studio"}})]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[a._v("After you have connected to your server, "),s("code",[a._v("Azure Data Studio")]),a._v(" wants you to add your Azure account. Follow the instructions and add your account.\nNext we want to create our first table in the MSFTEmployee. Navigate to the MSFTEmployee, open the context menu and select "),s("code",[a._v("New Query")]),a._v(".")])]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("üìù If your server is not detected under your account you might need to renew the firewall-rule again.")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql server firewall-rule create --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --name AllowYourIp --start-ip-address "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("your public ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --end-ip-address "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("your public Ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])])]),a._v(" "),s("p",[s("img",{attrs:{src:e(582),alt:"New Query"}})]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[a._v("Add and run the following query, creating a new Table:")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" PrtnrEmployees "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("EmployerID "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" LastName "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" FirstName "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" PartnerCompany "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" StartYear "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("Create a new query and insert additional contacts :")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INSERT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INTO")]),a._v(" PrtnrEmployees "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("EmployerID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" LastName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" FirstName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" PartnerCompany"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" StartYear"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("VALUES")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("View the data returned by a query")])]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" PrtnrEmployees"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" CEOs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h2",{attrs:{id:"access-management-for-azure-sql-db-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#access-management-for-azure-sql-db-optional"}},[a._v("#")]),a._v(" Access Management for Azure SQL DB (optional)")]),a._v(" "),s("p",[a._v("Under Access Management we are taking a look at authentication and authorization. "),s("em",[a._v("Authentication")]),a._v(" is the process of proving the users are who they claim to be. "),s("em",[a._v("Authorization")]),a._v(" refers to the permissions assigned to a user within an Azure SQL Database, and determines what the user is allowed to do.")]),a._v(" "),s("p",[a._v("Azure SQL Database supports two types of authentication: SQL authentication, as we have used before in creating the TestUser. And Azure Active Directory authentication.")]),a._v(" "),s("p",[a._v("Let's have a look at the SQL authentication. As server admin you can create additional SQL users - which enables other users to connect to the SQL Database. Create a new query.")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("USER")]),a._v(" Marvin "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WITH")]),a._v(" PASSWORD "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'42_as_ANSWER!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Now you can sign up as this user.")]),a._v(" "),s("p",[a._v("Before we did grant the "),s("code",[a._v("TestUser")]),a._v(" select access to the Table CEOs. Similarly you can create a custom role. There is also a set of fixed roles. They can be assigned as followes:")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ALTER")]),a._v(" ROLE  db_backupoperator "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ADD")]),a._v(" MEMBER Marvin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("img",{attrs:{src:e(583),alt:"Fixed Rules"}})]),a._v(" "),s("h2",{attrs:{id:"connect-the-azure-sql-db-to-a-web-application-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#connect-the-azure-sql-db-to-a-web-application-optional"}},[a._v("#")]),a._v(" Connect the Azure SQL DB to a Web Application (optional)")]),a._v(" "),s("p",[a._v("This tutorial shows how to create a .NET Core app and connect it to a SQL Database. When you're done, you'll have a .NET Core MVC app running in App Service.")]),a._v(" "),s("ol",[s("li",[a._v("Clone the sample application")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/azure-samples/dotnetcore-sqldb-tutorial\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" dotnetcore-sqldb-tutorial\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("Install the required packages, run database migrations, and start the application.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("   dotnet tool "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --global dotnet-ef\n   dotnet restore\n   dotnet ef database update\n   dotnet run\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[a._v("Navigate to "),s("code",[a._v("http://localhost:5000")]),a._v(" in a browser. Select the Create New link and create a couple to-do items. To stop .NET Core at any time, press "),s("code",[a._v("Ctrl+C")]),a._v(" in the terminal.")])]),a._v(" "),s("li",[s("p",[a._v("Create a new database in the previously created SQL Server.")])])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql db create --resource-group adc-sql-db-rg --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --name coreDB\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[a._v("Create the connection string")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az sql db show-connection-string --name coreDB --server "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --client sqlcmd\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[a._v("The result should look something like this:")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Server")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("tcp:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(".database.windows.net,1433"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Database")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("coreDB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("User "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Encrypt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("Connection "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Timeout")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[a._v("Configure a local git deployment. FTP and local Git can deploy to an Azure web app by using a deployment user. Once you configure your deployment user, you can use it for all your Azure deployments.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az webapp deployment user "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" --user-name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your app user"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --password "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("pwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[a._v("Create an App Service plan. An App Service plan defines a set of compute resources for a web app to run. These compute resources are analogous to the server farm in conventional web hosting. One or more apps can be configured to run on the same computing resources (or in the same App Service plan).")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az appservice plan create --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your asp"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --sku FREE\n")])])]),s("ol",{attrs:{start:"9"}},[s("li",[a._v("Create a web app in the recently created App Service plan.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az webapp create --resource-group adc-sql-db-rg --plan "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your asp"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("your app name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --deployment-local-git\n")])])]),s("ol",{attrs:{start:"10"}},[s("li",[a._v("Configure the connection string. To set connection strings for your Azure app, use the az webapp config appsettings set command in the Cloud Shell. In the following command replace the [Your Connection String] parameter with the connection string you created earlier.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az webapp config connection-string "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" --resource-group adc-sql-db-rg --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --settings "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MyDbConnection")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<Your Connection String>"')]),a._v(" --connection-string-type SQLServer\n")])])]),s("ol",{attrs:{start:"11"}},[s("li",[a._v("In ASP.NET Core, you can use this named connection string ("),s("code",[a._v("MyDbConnection")]),a._v(") using the standard pattern, like any connection string specified in "),s("code",[a._v("appsettings.json")]),a._v(". In this case, "),s("code",[a._v("MyDbConnection")]),a._v(" is also defined in your "),s("code",[a._v("appsettings.json")]),a._v(". When running in App Service, the connection string defined in App Service takes precedence over the connection string defined in your "),s("code",[a._v("appsettings.json")]),a._v(". The code uses the appsettings.json value during local development, and the same code uses the App Service value when deployed.")])]),a._v(" "),s("p",[a._v("Configure environment variable. Next, set "),s("code",[a._v("ASPNETCORE_ENVIRONMENT")]),a._v(" app setting to Production. This setting lets you know whether you're running in Azure, because you use SQLite for your local development environment and SQL Database for your Azure environment.")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az webapp config appsettings "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" --name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" --resource-group adc-sql-db-rg --settings "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ASPNETCORE_ENVIRONMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Production"')]),a._v("\n")])])]),s("ol",{attrs:{start:"12"}},[s("li",[a._v("Connect to SQL Database in production by opening the Startup.cs and finding the following code in your local repository:")])]),a._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[a._v("services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token generic-method"}},[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("AddDbContext")]),s("span",{pre:!0,attrs:{class:"token generic class-name"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("MyDatabaseContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("options "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v("\n     options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("UseSqlite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Data Source=localdatabase.db"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("ol",{attrs:{start:"13"}},[s("li",[a._v("Replace it with the following code, which uses the environment variables that you configured earlier.")])]),a._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Use SQL Database if in Azure, otherwise, use SQLite")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Environment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("GetEnvironmentVariable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ASPNETCORE_ENVIRONMENT"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Production"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token generic-method"}},[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("AddDbContext")]),s("span",{pre:!0,attrs:{class:"token generic class-name"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("MyDatabaseContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("options "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v("\n         options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("UseSqlServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("GetConnectionString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MyDbConnection"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n     services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token generic-method"}},[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("AddDbContext")]),s("span",{pre:!0,attrs:{class:"token generic class-name"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("MyDatabaseContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("options "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v("\n         options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("UseSqlite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Data Source=localdatabase.db"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Automatically perform database migration")]),a._v("\n   services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("BuildServiceProvider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token generic-method"}},[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("GetService")]),s("span",{pre:!0,attrs:{class:"token generic class-name"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("MyDatabaseContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Migrate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("If this code detects that it's running in production (which indicates the Azure environment), then it uses the connection string you configured to connect to the SQL Database.")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("üìù The "),s("code",[a._v("Database.Migrate()")]),a._v(" call helps you when it's run in Azure, because it automatically creates the databases that your .NET Core app needs, based on its migration configuration.")])]),a._v(" "),s("ol",{attrs:{start:"14"}},[s("li",[a._v("Save your changes, then commit it into your Git repository.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" commit -m "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"connect to SQL DB in Azure"')]),a._v("\n")])])]),s("ol",{attrs:{start:"15"}},[s("li",[a._v("Push to Azure from Git. Add an Azure remote to your local Git repository. Replace [Local Git URL] with the URL of the Git remote from step 7, when ypu did create the web app.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" remote "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" azure "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Local Git URL"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("ol",{attrs:{start:"16"}},[s("li",[a._v("Push to the Azure remote to deploy your app with the following command. When Git Credential Manager prompts you for credentials, make sure you enter the credentials you created in Configure a deployment user, not the credentials you use to sign in to the Azure portal. This might take some time.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" push azure master\n")])])]),s("ol",{attrs:{start:"17"}},[s("li",[a._v("Browse to the deployed app using your web browser.")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("http://"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name of your app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(".azurewebsites.net\n")])])]),s("h2",{attrs:{id:"cleanup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cleanup"}},[a._v("#")]),a._v(" Cleanup")]),a._v(" "),s("p",[a._v("Remove the sample resource group:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("az group delete --name adc-sql-db-rg\n")])])]),s("p",[s("RouterLink",{attrs:{to:"/day3/challenges/01-challenge-cosmosdb.html"}},[a._v("‚óÄ Previous challenge")]),a._v(" | "),s("RouterLink",{attrs:{to:"/day3/"}},[a._v("üîº Day 3")]),a._v(" | "),s("RouterLink",{attrs:{to:"/day3/challenges/03-challenge-search.html"}},[a._v("Next challenge ‚ñ∂")])],1)])}),[],!1,null,null,null);t.default=r.exports}}]);