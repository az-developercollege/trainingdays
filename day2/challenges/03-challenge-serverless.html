<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge 2: Serverless | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.307428eb.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.f35de7a7.js" as="script"><link rel="preload" href="/trainingdays/assets/js/2.989cf5bf.js" as="script"><link rel="preload" href="/trainingdays/assets/js/15.e7b4cb61.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.780aeda4.js"><link rel="prefetch" href="/trainingdays/assets/js/11.4c6423b8.js"><link rel="prefetch" href="/trainingdays/assets/js/12.fcf4e990.js"><link rel="prefetch" href="/trainingdays/assets/js/13.e01097b2.js"><link rel="prefetch" href="/trainingdays/assets/js/14.8555b734.js"><link rel="prefetch" href="/trainingdays/assets/js/16.ca0534a3.js"><link rel="prefetch" href="/trainingdays/assets/js/17.9f693448.js"><link rel="prefetch" href="/trainingdays/assets/js/18.2f2093d6.js"><link rel="prefetch" href="/trainingdays/assets/js/19.9e4b55d0.js"><link rel="prefetch" href="/trainingdays/assets/js/20.476d977c.js"><link rel="prefetch" href="/trainingdays/assets/js/21.b31a3392.js"><link rel="prefetch" href="/trainingdays/assets/js/22.3f90568e.js"><link rel="prefetch" href="/trainingdays/assets/js/23.d6548904.js"><link rel="prefetch" href="/trainingdays/assets/js/24.83e5af0f.js"><link rel="prefetch" href="/trainingdays/assets/js/25.83c4ee46.js"><link rel="prefetch" href="/trainingdays/assets/js/26.e72c9381.js"><link rel="prefetch" href="/trainingdays/assets/js/27.9536bb3f.js"><link rel="prefetch" href="/trainingdays/assets/js/28.70f1ef7a.js"><link rel="prefetch" href="/trainingdays/assets/js/29.3801b9b5.js"><link rel="prefetch" href="/trainingdays/assets/js/3.2e517bab.js"><link rel="prefetch" href="/trainingdays/assets/js/30.3d0f53bb.js"><link rel="prefetch" href="/trainingdays/assets/js/31.fd5d8ddb.js"><link rel="prefetch" href="/trainingdays/assets/js/32.0e00bee7.js"><link rel="prefetch" href="/trainingdays/assets/js/33.2fb17a4b.js"><link rel="prefetch" href="/trainingdays/assets/js/34.a0a1c041.js"><link rel="prefetch" href="/trainingdays/assets/js/35.7e58dabe.js"><link rel="prefetch" href="/trainingdays/assets/js/36.f2c555a8.js"><link rel="prefetch" href="/trainingdays/assets/js/37.1ec7a02f.js"><link rel="prefetch" href="/trainingdays/assets/js/38.bb236e14.js"><link rel="prefetch" href="/trainingdays/assets/js/39.12a794aa.js"><link rel="prefetch" href="/trainingdays/assets/js/4.076fa189.js"><link rel="prefetch" href="/trainingdays/assets/js/40.f93c86e0.js"><link rel="prefetch" href="/trainingdays/assets/js/41.c39ede3a.js"><link rel="prefetch" href="/trainingdays/assets/js/42.554cec04.js"><link rel="prefetch" href="/trainingdays/assets/js/43.5bd4eeb1.js"><link rel="prefetch" href="/trainingdays/assets/js/44.74e2d89b.js"><link rel="prefetch" href="/trainingdays/assets/js/45.6f467ebc.js"><link rel="prefetch" href="/trainingdays/assets/js/46.b13f8c9f.js"><link rel="prefetch" href="/trainingdays/assets/js/47.db58a6dd.js"><link rel="prefetch" href="/trainingdays/assets/js/48.9234eefe.js"><link rel="prefetch" href="/trainingdays/assets/js/49.f520e854.js"><link rel="prefetch" href="/trainingdays/assets/js/5.cd4a6f92.js"><link rel="prefetch" href="/trainingdays/assets/js/50.f76042e4.js"><link rel="prefetch" href="/trainingdays/assets/js/51.e48d1f47.js"><link rel="prefetch" href="/trainingdays/assets/js/52.1a0f794c.js"><link rel="prefetch" href="/trainingdays/assets/js/53.34b352ea.js"><link rel="prefetch" href="/trainingdays/assets/js/54.413dfc7f.js"><link rel="prefetch" href="/trainingdays/assets/js/55.6630c97c.js"><link rel="prefetch" href="/trainingdays/assets/js/56.e0c1984b.js"><link rel="prefetch" href="/trainingdays/assets/js/57.e8b3165a.js"><link rel="prefetch" href="/trainingdays/assets/js/58.f0b5c00b.js"><link rel="prefetch" href="/trainingdays/assets/js/59.3f39eda3.js"><link rel="prefetch" href="/trainingdays/assets/js/6.08ea3b2a.js"><link rel="prefetch" href="/trainingdays/assets/js/60.1743d283.js"><link rel="prefetch" href="/trainingdays/assets/js/61.51333324.js"><link rel="prefetch" href="/trainingdays/assets/js/62.d8fe34bc.js"><link rel="prefetch" href="/trainingdays/assets/js/63.f95b8160.js"><link rel="prefetch" href="/trainingdays/assets/js/64.414eae6e.js"><link rel="prefetch" href="/trainingdays/assets/js/65.2d78468c.js"><link rel="prefetch" href="/trainingdays/assets/js/66.a7d06d35.js"><link rel="prefetch" href="/trainingdays/assets/js/67.5de73a5e.js"><link rel="prefetch" href="/trainingdays/assets/js/68.f6f4c427.js"><link rel="prefetch" href="/trainingdays/assets/js/69.aa3c0657.js"><link rel="prefetch" href="/trainingdays/assets/js/7.0e2524bf.js"><link rel="prefetch" href="/trainingdays/assets/js/70.c116a905.js"><link rel="prefetch" href="/trainingdays/assets/js/71.34bb5f4a.js"><link rel="prefetch" href="/trainingdays/assets/js/72.aa9947e8.js"><link rel="prefetch" href="/trainingdays/assets/js/73.a6dc05e7.js"><link rel="prefetch" href="/trainingdays/assets/js/74.774c0f8b.js"><link rel="prefetch" href="/trainingdays/assets/js/75.8fcc3a21.js"><link rel="prefetch" href="/trainingdays/assets/js/76.46acaa39.js"><link rel="prefetch" href="/trainingdays/assets/js/77.2df5fe59.js"><link rel="prefetch" href="/trainingdays/assets/js/78.621183e7.js"><link rel="prefetch" href="/trainingdays/assets/js/79.f73262ec.js"><link rel="prefetch" href="/trainingdays/assets/js/8.5c71bfb1.js"><link rel="prefetch" href="/trainingdays/assets/js/80.4a8fd06d.js"><link rel="prefetch" href="/trainingdays/assets/js/81.59dd494b.js"><link rel="prefetch" href="/trainingdays/assets/js/82.cae84daa.js"><link rel="prefetch" href="/trainingdays/assets/js/83.b6a17fc2.js"><link rel="prefetch" href="/trainingdays/assets/js/84.ad8a0c10.js"><link rel="prefetch" href="/trainingdays/assets/js/85.7b07e28f.js"><link rel="prefetch" href="/trainingdays/assets/js/86.40cfbbdd.js"><link rel="prefetch" href="/trainingdays/assets/js/87.4f11b827.js"><link rel="prefetch" href="/trainingdays/assets/js/88.cb9bf9cf.js"><link rel="prefetch" href="/trainingdays/assets/js/89.38bab1ab.js"><link rel="prefetch" href="/trainingdays/assets/js/9.b747e0f0.js"><link rel="prefetch" href="/trainingdays/assets/js/90.3ae9a1f4.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.307428eb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" aria-current="page" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 DevOps and Monitoring</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="challenge-2-serverless"><a href="#challenge-2-serverless" class="header-anchor">#</a> Challenge 2: Serverless</h1> <p>‚è≤Ô∏è <em>Est. time to complete: 45 min.</em> ‚è≤Ô∏è</p> <h2 id="here-is-what-you-will-learn-üéØ"><a href="#here-is-what-you-will-learn-üéØ" class="header-anchor">#</a> Here is what you will learn üéØ</h2> <ul><li>Create an Azure Function on your local machine</li> <li>Learn how to debug Azure Functions</li> <li>Learn how to use Function Triggers to react to events in Azure</li> <li>Deploy Azure Functions</li></ul> <h2 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table Of Contents</h2> <ol><li><a href="#create-an-azure-function-locally">Create an Azure Function locally</a></li> <li><a href="#deploy-the-azure-function-app-to-azure">Deploy the Azure Function App to Azure</a></li> <li><a href="#azure-samples">Azure Samples</a></li> <li><a href="#cleanup">Cleanup</a></li></ol> <h2 id="create-an-azure-function-locally"><a href="#create-an-azure-function-locally" class="header-anchor">#</a> Create an Azure Function locally</h2> <p>To get familiar with <em>Azure Functions</em> on your local machine, we will create a sample that listens for files on an Azure Storage Account (Blob). Each time a new file is added to a predefined container, our function will be called by Azure, giving us the opportunity to manipulate the file and save it to another location (just a small sample).</p> <p>So, first of all, we need to create a Storage Account to being able to upload/process files.</p> <h3 id="add-a-storage-account"><a href="#add-a-storage-account" class="header-anchor">#</a> Add a Storage Account</h3> <p>Go to the Azure Portal and click on <strong>&quot;Create a resource&quot;</strong>, in the next view choose/search for <strong>&quot;Storage Account&quot;</strong> and afterwards click <strong>create</strong>.</p> <p>Follow the wizard to create the storage account:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Resource group</em></td> <td>new, serverless-rg</td></tr> <tr><td>Name</td> <td>Give your account a <em>globally unique</em> name</td></tr> <tr><td><em>Location</em></td> <td>West Europe</td></tr> <tr><td><em>Performance Tier</em></td> <td>Standard</td></tr> <tr><td><em>Account Kind</em></td> <td>Storage V2 (General Purpose)</td></tr> <tr><td><em>Replication</em></td> <td>Locally-redundant storage (LRS)</td></tr> <tr><td><em>Access Tier</em></td> <td>Hot</td></tr></tbody></table> <p>Leave all other options to their defaults. In the summary view, it should look like that:</p> <p><img src="/trainingdays/assets/img/portal_storageaccount.42e7a95b.png" alt="create" title="create"></p> <p>Proceed and create the Storage Account.</p> <p>When the deployment has finished</p> <ul><li>Go to the storage account and open <strong>&quot;Containers&quot;</strong> (under &quot;Blob service&quot;)</li> <li>Create a container called <strong>originals</strong> and another one called <strong>processed</strong></li> <li>Leave the proposed settings for <strong>Public Access Level</strong> - <em>Private</em>.</li></ul> <p>The infrastructure to store files is now ready. Let's create the local Azure Function.</p> <h3 id="create-the-local-function-app"><a href="#create-the-local-function-app" class="header-anchor">#</a> Create the local Function App</h3> <p>Open a new Visual Studio Code window and switch to the Azure Tools Extension. In the section for <strong>&quot;Functions&quot;</strong>, click on <strong>&quot;Create New Project&quot;</strong> and select a new, empty folder on your local machine:</p> <p><img src="/trainingdays/assets/img/function_create.f2a257fb.png" alt="func_create" title="func_create"></p> <p>The Wizard will guide you through the local setup process.</p> <p>Choose the following options:</p> <ul><li><em>Language</em>: C#
<img src="/trainingdays/assets/img/functions_wizard1.80854a36.png" alt="functions_wizard1" title="functions_wizard1"></li> <li><em>Template</em>: BlobTrigger
<img src="/trainingdays/assets/img/functions_wizard2.8957d094.png" alt="functions_wizard2" title="functions_wizard2"></li> <li><em>Function Name</em>: BlobTriggerCSharp
<img src="/trainingdays/assets/img/functions_wizard3.21fd1514.png" alt="functions_wizard3" title="functions_wizard3"></li> <li><em>Namespace</em>: AzDevCollege.Function
<img src="/trainingdays/assets/img/functions_wizard4.0a1935a1.png" alt="functions_wizard4" title="functions_wizard4"></li> <li><em>Settings</em>: Create new local app setting
<img src="/trainingdays/assets/img/functions_wizard5.d7f6fc92.png" alt="functions_wizard5" title="functions_wizard5"></li> <li><em>Storage Account</em>: select the storage account you created previously
<img src="/trainingdays/assets/img/functions_wizard6.cc694b88.png" alt="functions_wizard6" title="functions_wizard6"></li> <li><em>Trigger Path</em> (the container name we want to listen to for new files): originals
<img src="/trainingdays/assets/img/functions_wizard7.25ae7287.png" alt="functions_wizard7" title="functions_wizard7"></li> <li><em>Debug</em>: select the same storage account as above</li></ul> <p>When everything is setup, we test the function.</p> <ul><li>Open <code>BlobTriggerCSharp.cs</code> file and set a breakpoint in the <code>Run</code> method.</li> <li>Start the Azure Function by hitting <strong>F5</strong>.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>üìù If you get a message that the core function tools are required, install them by executing <code>npm i -g azure-functions-core-tools@3 --unsafe-perm true</code>. If you still see an error, it's likely that remote-signed Powershell scripts aren't allowed on your machine. To fix that, run <code>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned</code> in a Powershell environment (as <em>admin</em>).</p></div> <p>The debug console should print logs like that:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token operator">&gt;</span> func start

Azure Functions Core Tools
Core Tools Version:       <span class="token number">3.0</span>.3284 Commit hash: 98bc25e668274edd175a1647fe5a9bc4ffb6887d
Function Runtime Version: <span class="token number">3.0</span>.15371.0
</code></pre></div><p>Open the <em>Azure Storage Explorer</em>, find your storage account and select the <code>originals</code> container (alternatively: go to the Portal and open the &quot;Storage Explorer&quot; in the Storage Account).</p> <p><img src="/trainingdays/assets/img/storage_explorer_view.52ed3f13.png" alt="storage_explorer_view" title="storage_explorer_view"></p> <p>Drag and drop a file to the container or upload one via the menu. After a few seconds, the breakpoint in VS Code will be hit. Examine the properties of the variable <code>myBlob</code>.</p> <h3 id="adjusting-the-sample"><a href="#adjusting-the-sample" class="header-anchor">#</a> Adjusting the Sample</h3> <p>We can now receive events when a file is added to blob storage. Let's add a more meaningful sample.</p> <p>We want to receive images that we will resize/manipulate in our function and write the result to the <strong>processed</strong> container. Therefore, we need to add a dependency to our project that enables us to do image manipulation in dotnet core. We will use <a href="https://github.com/SixLabors/ImageSharp" target="_blank" rel="noopener noreferrer">SixLabors.ImageSharp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Open a terminal and go to your projects folder. Add the library via:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dotnet <span class="token function">add</span> <span class="token operator">&lt;</span>NAME_OF_FUNCTION_PROJECT<span class="token operator">&gt;</span>.csproj package SixLabors.ImageSharp
</code></pre></div><p>Now, back in Visual Studio Code, replace the contents of the file <code>BlobTriggerCSharp.cs</code> with:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Host</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">SixLabors<span class="token punctuation">.</span>ImageSharp</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">SixLabors<span class="token punctuation">.</span>ImageSharp<span class="token punctuation">.</span>Processing</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">AzDevCollege<span class="token punctuation">.</span>Function</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BlobTriggerCSharp</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FunctionName</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>BlobTriggerCSharp<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">BlobTrigger</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;originals/{name}&quot;</span><span class="token punctuation">,</span> Connection <span class="token operator">=</span> <span class="token string">&quot;&lt;REPLACE_WITH_NAME_OF_STORAGE_ACCOUNT&gt;_STORAGE&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token class-name">Stream</span> myBlob<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Blob</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;processed/proc_{name}&quot;</span><span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">,</span> Connection <span class="token operator">=</span> <span class="token string">&quot;&lt;REPLACE_WITH_NAME_OF_STORAGE_ACCOUNT&gt;_STORAGE&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token class-name">Stream</span> outStream<span class="token punctuation">,</span> <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">Image</span> image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>myBlob<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Resize and rotate the image!</span>
                image<span class="token punctuation">.</span><span class="token function">Mutate</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">Resize</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>Height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                image<span class="token punctuation">.</span><span class="token function">Mutate</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">Rotate</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                image<span class="token punctuation">.</span><span class="token function">SaveAsJpeg</span><span class="token punctuation">(</span>outStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;C# Blob trigger function Processed blob\n Name:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">name</span><span class="token punctuation">}</span></span><span class="token string"> \n Size: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">myBlob<span class="token punctuation">.</span>Length</span><span class="token punctuation">}</span></span><span class="token string"> Bytes&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>What has been added to the <strong>Run</strong> method:</p> <ul><li>The parameter <code>[Blob(&quot;processed/proc_{name}&quot;, FileAccess.Write)] Stream outStream</code> to automatically write the results of the image manipulation to a blob in the container <strong>processed</strong> having the same file name, prefixed with &quot;proc&quot;. This is called an <em>Output Binding</em>. You simply write data to these kind of annotated variables and Azure takes care of storing to the configured data store. For more information on that, see <a href="https://docs.microsoft.com/azure/azure-functions/functions-bindings-storage-blob?tabs=csharp#output" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/azure/azure-functions/functions-bindings-storage-blob?tabs=csharp#output<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>The code needed to manipulate the input image in the <code>using</code> statement</li></ul> <p>Now restart the local Azure Function and when the function is ready to accept calls, go to the Storage Explorer and drag an image (<strong>!use an image!</strong>) to the folder <strong>originals</strong>. A few seconds later, you will see that the Azure Function has been triggered.</p> <p>Now check the <strong>processed</strong> container. You will find a new <code>proc\_</code>-image with the results of our manipulation.</p> <p>If everything works as expected on your local machine, we deploy the Azure Function to Azure.</p> <h2 id="deploy-the-azure-function-app-to-azure"><a href="#deploy-the-azure-function-app-to-azure" class="header-anchor">#</a> Deploy the Azure Function App to Azure</h2> <p>Go to the Azure Tools Extension and click on the <strong>&quot;Deploy to Azure...&quot;</strong> button in the <strong>&quot;Functions&quot;</strong> section. A wizard will guide you through the creation process.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>üìù Choose <em>Advanced</em> mode.</p></div> <p><img src="/trainingdays/assets/img/functions_deploy_wizard1.ba3125ef.png" alt="functions_deploy_wizard1" title="functions_deploy_wizard1"></p> <p>Choose the following options, when asked:</p> <table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td><em>Runtime</em></td> <td>NET Core 3.1</td></tr> <tr><td><em>OS</em></td> <td>Windows</td></tr> <tr><td><em>Hosting Plan</em></td> <td>Consumption</td></tr> <tr><td><em>Resource Group</em></td> <td>serverless-rg</td></tr> <tr><td><em>Storage Account</em></td> <td>The same as you used in the local sample</td></tr> <tr><td><em>Application Insights</em></td> <td>Skip for now</td></tr></tbody></table> <p>We still have to configure our Functions App, to be able to listen to blob changes in the Storage Account (<em>BlobTrigger information</em>). Therefore</p> <ul><li>Go to the Portal and open the Functions App you previously created.</li> <li>Open the Application settings under <strong>Configuration</strong></li> <li>Add a new application setting (you can check your <code>local.settings.json</code> file for the correct values):
<table><thead><tr><th>Parameter</th> <th>Value</th></tr></thead> <tbody><tr><td>&lt;storageaccountname&gt;_STORAGE</td> <td>enter the connection string to the storage account (you can copy that from your <em>local.settings.json</em> file)</td></tr></tbody></table></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>üìù Make sure to click on <em>Save</em> afterwards.</p></div> <p>Finally, your application settings should look like that:</p> <p><img src="/trainingdays/assets/img/azure_function_settings.805a54cf.png" alt="azure_function_settings" title="azure_function_settings"></p> <p>Test again (upload images) and check, if the Function App is running correctly in Azure</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>üìù It might be necessary to restart your function app.</p></div> <h2 id="azure-samples"><a href="#azure-samples" class="header-anchor">#</a> Azure Samples</h2> <p>Azure Functions code samples:</p> <ul><li><a href="https://docs.microsoft.com/samples/browse/?expanded=azure&amp;products=azure-functions" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/samples/browse/?expanded=azure&amp;products=azure-functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h2> <p>Remove the sample resource group via</p> <div class="language-shell extra-class"><pre class="language-shell"><code>az group delete -n serverless-rg
</code></pre></div><p><a href="/trainingdays/day2/challenges/02-challenge-bo-1.html">‚óÄ Previous challenge</a> | <a href="/trainingdays/day2/" class="router-link-active">üîº Day 2</a> | <a href="/trainingdays/day2/challenges/04-challenge-messaging.html">Next challenge ‚ñ∂</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day2/challenges/03-challenge-serverless.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.f35de7a7.js" defer></script><script src="/trainingdays/assets/js/2.989cf5bf.js" defer></script><script src="/trainingdays/assets/js/15.e7b4cb61.js" defer></script>
  </body>
</html>
